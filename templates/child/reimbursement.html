{% extends "base.html" %}

{% block title %}Reimburse Summer Charger Points{% endblock %}

{% block content %}
<div class="container mt-4">
    <div class="row">
        <div class="col-12">
            <h1 class="text-center mb-4">🌟 Reimburse Summer Charger Points 🌟</h1>
            
            <!-- Points and Status Banner -->
            <div class="alert alert-info text-center">
                <h4>💰 Your Total Points: {{ total_points }} 💰</h4>
                {% if weekly_status.can_reimburse %}
                    <p class="mb-0">✅ You can reimburse this week! (Resets every Friday)</p>
                {% else %}
                    <p class="mb-0">⏰ You've already used your weekly reimbursement. Try again next Friday!</p>
                    {% if weekly_status.last_reimbursement %}
                        <small>Last reimbursement: {{ weekly_status.last_reimbursement.strftime('%B %d, %Y') }}</small>
                    {% endif %}
                {% endif %}
            </div>

            <!-- Error/Success Messages -->
            {% if error %}
                <div class="alert alert-danger">
                    <strong>Oops!</strong> {{ error }}
                </div>
            {% endif %}
            
            {% if success %}
                <div class="alert alert-success">
                    <strong>🎉 Success!</strong> {{ success }}
                </div>
            {% endif %}

            <!-- Reimbursement Items Grid -->
            <div class="reimbursement-grid" style="display: flex; flex-wrap: wrap; margin: -1px;">
                {% for item in items %}
                <div class="reimbursement-item" style="flex: 0 0 100%; max-width: 100%; padding: 1px;">
                    <div class="card h-100 reimbursement-card {% if not weekly_status.can_reimburse or total_points < item.points_cost %}card-disabled{% endif %}">
                        <div class="card-body text-center">
                            <h6 class="card-title mb-2">{{ item.name }}</h6>
                            <p class="card-text small mb-2">{{ item.description }}</p>
                            <div class="points-badge mb-2">
                                <span class="badge bg-primary">{{ item.points_cost }} Points</span>
                            </div>
                            
                            {% if weekly_status.can_reimburse and total_points >= item.points_cost %}
                                <a href="/reimbursement/confirm/{{ item.name }}" class="btn btn-success btn-sm">
                                    🎁 Redeem
                                </a>
                            {% elif not weekly_status.can_reimburse %}
                                <button class="btn btn-secondary btn-sm" disabled>
                                    ⏰ Weekly Limit
                                </button>
                            {% elif total_points < item.points_cost %}
                                <button class="btn btn-secondary btn-sm" disabled>
                                    💰 Need {{ item.points_cost - total_points }} More
                                </button>
                            {% endif %}
                        </div>
                    </div>
                </div>
                {% endfor %}
            </div>

            <!-- Navigation -->
            <div class="row mt-4">
                <div class="col-12 text-center">
                    <a href="/dashboard/child" class="btn btn-outline-primary me-2">
                        ← Back to Dashboard
                    </a>
                    <a href="/reimbursement/history" class="btn btn-outline-info">
                        📋 View My History
                    </a>
                </div>
            </div>
        </div>
    </div>
</div>

<style>
.card-disabled {
    opacity: 0.6;
}

.points-badge {
    margin: 10px 0;
}

.reimbursement-grid {
    margin: -1px;
}

.reimbursement-grid > * {
    padding: 1px;
}

.reimbursement-card {
    transition: transform 0.2s;
    border: 2px solid #e9ecef;
    min-height: 200px;
}

.reimbursement-card:hover {
    transform: translateY(-3px);
    box-shadow: 0 4px 8px rgba(0,0,0,0.1);
}

.card-disabled:hover {
    transform: none;
}

.card-body {
    padding: 1rem;
}

.card-title {
    font-size: 1rem;
    font-weight: bold;
}

.card-text {
    font-size: 0.875rem;
    line-height: 1.3;
}

.btn-sm {
    padding: 0.375rem 0.75rem;
    font-size: 0.875rem;
}

/* Responsive grid */
@media (min-width: 576px) {
    .reimbursement-item {
        flex: 0 0 50% !important;
        max-width: 50% !important;
    }
}

/* Force 3 tiles per row on desktop (768px+) */
@media (min-width: 768px) {
    .reimbursement-item {
        flex: 0 0 33.333333% !important;
        max-width: 33.333333% !important;
    }
}
</style>
{% endblock %} 